/*
  Ferro Slider
  Requires jQuery (tested on 1.6.1, but no new features used).
  Requires (optional) jQuery easing (tested on 1.3, but no new features used).

  Copyright 2011 Ferro
  
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
  http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/
(function($){var methods={ferroSliderDesktop:function(options){var defaults={ajaxLoading:false,ajaxScript:'',axis:'',backGroundImageClass:'',container:'none',createLinks:false,createMap:false,displace:'row',easing:'linear',feedbackArrows:false,fullScreenBackground:false,linkClass:'',mapPosition:'bottom_right',preloadBackgroundImages:false,time:300};var opts=$.extend({},defaults,options);var matrix=new Array();var matrixOrder=new Array();var displayWidth=0;var displayHeight=0;var offsetX=0;var offsetY=0;var initialPositionX=0;var initialPositionY=0;var actualCol=0;var actualRow=0;var elementToScroll="html,body";var zIndex=-1000;var zIndexDecrement=0;var matrixRows=0;var matrixColumns=0;var actualOffsetX=0;var actualOffsetY=0;initializeWorkspace(this);placeElements();$(elementToScroll).animate({scrollTop:initialPositionY,scrollLeft:initialPositionX},0,function(){actualOffsetY=initialPositionY;actualOffsetX=initialPositionX});$(document.body).append("<div id='slidingSpacesNavigationFeedback'></div>");$("#slidingSpacesNavigationFeedback").hide();$("#slidingSpacesNavigationFeedback").width(displayWidth);$("#slidingSpacesNavigationFeedback").height(displayHeight);$("#slidingSpacesNavigationFeedback").css({marginLeft:offsetX,marginTop:offsetY});var anchor=window.location.hash;if($.trim(anchor)!=""){var actualEl=findElementById(anchor.replace("#",""));actualCol=actualEl.column;actualRow=actualEl.row}if(opts.createLinks){$(".slidingSpacesOuterDiv").each(function(index){var $el=$(this);$el.append("<div id='slidingSpacesNavigation_"+$el.attr("id")+"' class='slidingSpacesNavigation'><ul></ul></div>");for(var i=0;i<matrixOrder.length;i++){if(index!=i){if($("#"+matrixOrder[i].id).attr("title")!=""&&$("#"+matrixOrder[i].id).attr("title")!=null){var linkTitle=$("#"+matrixOrder[i].id).attr("title")}else{var linkTitle="Page "+i}$("#slidingSpacesNavigation_"+$el.attr("id")+" ul").append("<li><a href='#"+matrixOrder[i].id+"' class='slidingSpacesNavigationLink' >"+linkTitle+"</a></li>")}}})}if(opts.createMap){createMap()}$(document).keydown(function(e){var keyCode=e.keyCode||e.which;var arrow={left:37,up:38,right:39,down:40};var go=false;var direction=null;var iCol=actualCol;var iRow=actualRow;switch(keyCode){case arrow.left:e.preventDefault();if(actualCol>0){var toMove=findElementByPosition(actualRow,(actualCol-1));if(toMove.id!=null){actualCol--;go=true}}break;case arrow.up:e.preventDefault();if(actualRow>0){var toMove=findElementByPosition((actualRow-1),actualCol);if(toMove.id!=null){actualRow--;go=true}}break;case arrow.right:e.preventDefault();if(actualCol<matrixColumns){var toMove=findElementByPosition(actualRow,(actualCol+1));if(toMove.id!=null){actualCol++;go=true}}break;case arrow.down:e.preventDefault();if(actualRow<matrixRows){var toMove=findElementByPosition((actualRow+1),actualCol);if(toMove.id!=null){actualRow++;go=true}}break}if(go){var leftShift=toMove.column*(displayWidth);var topShift=toMove.row*(displayHeight);fireNavigationFeedback(iCol,iRow,actualCol,actualRow);$(elementToScroll).stop();$(elementToScroll).animate({scrollTop:topShift,scrollLeft:leftShift},opts.time,opts.easing,function(){$(elementToScroll).stop();actualOffsetY=topShift;actualOffsetX=leftShift;loadContent(toMove);$(elementToScroll).animate({scrollTop:topShift,scrollLeft:leftShift},0)});if(opts.createMap){refreshMap(toMove.id)}}});var linksClasses=".slidingSpacesNavigationLink, .slidingSpacesNavigationDot";if($.trim(opts.linkClass)!=""){var linksClasses=linksClasses+", ."+opts.linkClass}$(linksClasses).each(function(index){var $el=$(this);$el.bind("click",function(event){clickEvent(event,$el)})});$(window).resize(function(){var oldWidth=displayWidth;var oldHeight=displayHeight;setMagicNumbers();if(opts.container=='none'){refreshPosition(oldWidth,oldHeight);if(opts.createMap){positionMap()}}});function clickEvent(event,$el){event.preventDefault();$(elementToScroll).stop();var toMove=findElementById($el.attr("href").replace("#",""));var direction=null;var directionX=null;var directionY=null;var iRow=actualRow;var iColumn=actualCol;var axis=findElementByOffset(displayWidth,displayHeight).axis;var leftShift=toMove.column*(displayWidth);var topShift=toMove.row*(displayHeight);if(axis=='xy'){fireNavigationFeedback(actualCol,null,toMove.column,null);$(elementToScroll).animate({scrollLeft:leftShift},opts.time,opts.easing,function(){fireNavigationFeedback(null,iRow,null,toMove.row);$(elementToScroll).animate({scrollTop:topShift},opts.time,opts.easing,function(){initialPositionY=topShift;initialPositionX=leftShift;loadContent(toMove)})})}else if(axis=='yx'){fireNavigationFeedback(null,iRow,null,toMove.row);$(elementToScroll).animate({scrollTop:topShift},opts.time,opts.easing,function(){fireNavigationFeedback(iColumn,null,toMove.column,null);$(elementToScroll).animate({scrollLeft:leftShift},opts.time,opts.easing,function(){initialPositionY=topShift;initialPositionX=leftShift;loadContent(toMove)})})}else{fireNavigationFeedback(iColumn,iRow,toMove.column,toMove.row);$(elementToScroll).animate({scrollTop:topShift,scrollLeft:leftShift},opts.time,opts.easing,function(){initialPositionY=topShift;initialPositionX=leftShift;loadContent(toMove)})}actualCol=toMove.column;actualRow=toMove.row;actualOffsetX=leftShift;actualOffsetY=topShift;if(opts.createMap){refreshMap($el.attr("href").replace("#",""))}}function createMap(){$(elementToScroll).append("<div id='slidingSpacesNavigationMap'></div>");var actualElementId=findElementByOffset(displayWidth,displayHeight).id;for(var r=0;r<matrix.length;r++){for(var c=0;c<matrix[r].length;c++){var href="";var id="";var title="";var rightClass="slidingSpacesNavigationDot";if(matrix[r][c].full!=1){rightClass="slidingSpacesNavigationDotEmpty"}else{if(matrix[r][c].id==actualElementId){var rightClass="slidingSpacesNavigationDotActual"}else{var href="href='#"+matrix[r][c].id+"'"}}if(typeof(matrix[r][c].id)!="undefined"){id="id='slidingSpacesNavigationDot_"+matrix[r][c].id+"'"}if(typeof($("#"+matrix[r][c].id).attr("title"))!="undefined"){title="title='"+$("#"+matrix[r][c].id).attr("title")+"'"}$("#slidingSpacesNavigationMap").append("<a "+id+" class='"+rightClass+"' "+href+" "+title+"></a>")}$("#slidingSpacesNavigationMap").append("<br clear='all'/>")}$("#slidingSpacesNavigationMap").bind("mouseover",function(event){$("#slidingSpacesNavigationMap").stop();$("#slidingSpacesNavigationMap").animate({opacity:1},200)});$("#slidingSpacesNavigationMap").bind("mouseleave",function(event){$("#slidingSpacesNavigationMap").stop();$("#slidingSpacesNavigationMap").animate({opacity:0.5},0)});positionMap()}function findElementById(clicked){var found=false;var toReturn={id:null,column:-1,row:-1};$.each(matrixOrder,function(index){if(!found){if(matrixOrder[index].id==clicked){toReturn=matrixOrder[index];found=true}}});return toReturn}function findElementByOffset(oldWidth,oldHeight){var found=false;var toReturn={id:null,row:-1,column:-1};$.each(matrixOrder,function(index){if(!found){var topShift=matrixOrder[index].row*oldHeight;var leftShift=matrixOrder[index].column*oldWidth;if(topShift==actualOffsetY&&leftShift==actualOffsetX){toReturn=matrixOrder[index];found=true}}});return toReturn}function findElementByPosition(row,column){var found=false;var toReturn={id:null,column:-1,row:-1};$.each(matrixOrder,function(index){if(!found){if(matrixOrder[index].column==column&&matrixOrder[index].row==row){toReturn=matrixOrder[index];found=true}}});return toReturn}function fireNavigationFeedback(sColumn,sRow,eColumn,eRow){if(opts.feedbackArrows){var direction=null;var directionX=null;var directionY=null;if(sColumn>eColumn){directionX="left"}else if(sColumn<eColumn){directionX="right"}if(sRow>eRow){directionY="up"}else if(sRow<eRow){directionY="down"}if(directionY!=null){direction=directionY}if(directionX!=null){if(direction!=null){direction+="_"+directionX}else{direction=directionX}}if(direction!=null){var iconName="img/"+direction+"_arrow.png";$("#slidingSpacesNavigationFeedback").stop();$("#slidingSpacesNavigationFeedback").css({backgroundImage:"url("+iconName+")",backgroundRepeat:"no-repeat",backgroundPosition:"center center",opacity:"1","z-index":1000});$("#slidingSpacesNavigationFeedback").show();$("#slidingSpacesNavigationFeedback").animate({opacity:"0","z-index":"-100"},1000,function(){$("#slidingSpacesNavigationFeedback").hide()})}}}function initializeWorkspace(els){setMagicNumbers();if(typeof(opts.displace)=="object"){matrix=opts.displace;var orderIndex=0;for(var r=0;r<opts.displace.length;r++){for(var c=0;c<opts.displace[r].length;c++){if(opts.displace[r][c].full==1&&typeof(opts.displace[r][c].first)!="undefined"){var ajax=false;var loadC=true;var direction=opts.axis;if(typeof(opts.displace[r][c].ajaxLoading)!="undefined"){if(opts.displace[r][c].ajaxLoading){ajax=true;loadC=false}}else{if(opts.ajaxLoading){ajax=true;loadC=false}}if($.trim(opts.displace[r][c].moveDirection)!=""){direction=opts.displace[r][c].moveDirection}matrixOrder.push({id:els[orderIndex].id,row:r,column:c,ajaxLoading:ajax,loadedContent:loadC,axis:direction});matrix[r][c].id=els[orderIndex].id;initialPositionX=c*(displayWidth);initialPositionY=r*(displayHeight);actualCol=c;actualRow=r;orderIndex++;if(matrixRows<r){matrixRows=r}if(matrixColumns<c){matrixColumns=c}}}}for(var r=0;r<opts.displace.length;r++){for(var c=0;c<opts.displace[r].length;c++){if(opts.displace[r][c].full==1&&typeof(opts.displace[r][c].first)=="undefined"){if(orderIndex<els.length){var ajax=false;var loadC=true;var direction=opts.axis;if(typeof(opts.displace[r][c].ajaxLoading)!="undefined"){if(opts.displace[r][c].ajaxLoading){ajax=true;loadC=false}}else{if(opts.ajaxLoading){ajax=true;loadC=false}}if($.trim(opts.displace[r][c].moveDirection)!=""){direction=opts.displace[r][c].moveDirection}matrixOrder.push({id:els[orderIndex].id,row:r,column:c,ajaxLoading:ajax,loadedContent:loadC,axis:direction});if(matrixRows<r){matrixRows=r}if(matrixColumns<c){matrixColumns=c}matrix[r][c].id=els[orderIndex].id;orderIndex++}}}}}else{if(opts.displace=='row'){matrix[0]=new Array();for(f=0;f<els.length;f++){var ajax=false;var loadC=true;if(opts.ajaxLoading){ajax=true;loadC=false}matrixOrder.push({id:els[f].id,row:0,column:f,ajaxLoading:ajax,loadedContent:loadC,axis:opts.axis});matrix[0].push({id:els[f].id,full:1});matrixColumns++}}else if(opts.displace=='column'){matrix=new Array();for(var f=0;f<els.length;f++){var ajax=false;var loadC=true;if(opts.ajaxLoading){ajax=true;loadC=false}matrixOrder.push({id:els[f].id,row:f,column:0,ajaxLoading:ajax,loadedContent:loadC,axis:opts.axis});matrix[matrixRows]=new Array();matrix[matrixRows][0]={id:els[f].id,full:1};matrixRows++}}}}function loadContent(element){if(element.ajaxLoading&&!element.loadedContent){$("#slidingSpacesNavigationFeedback").stop();$("#slidingSpacesNavigationFeedback").css({backgroundColor:"#000000",backgroundImage:"url(img/throbber.gif)",backgroundRepeat:"no-repeat",backgroundPosition:"center center",opacity:"0.7","z-index":1000});$("#slidingSpacesNavigationFeedback").show();$.ajax({url:opts.ajaxScript,data:"id="+element.id,success:function(data){element.loadedContent=true;$("#"+element.id).append(data);$("#slidingSpacesNavigationFeedback").css({opacity:"0",backgroundColor:'transparent',"z-index":"-100"})},error:function(err){alert(err)}})}}function placeElements(){if(elementToScroll=="html,body"){var elementToPlace="body"}else{var elementToPlace=elementToScroll}for(var m=0;m<matrixOrder.length;m++){elId=matrixOrder[m].id;var outerDivId="slidingSpacesOuterDiv_"+elId;$(elementToPlace).append("<div id='"+outerDivId+"' class='slidingSpacesOuterDiv'></div>");$("#"+outerDivId).css("position","absolute");$("#"+outerDivId).css("overflow","hidden");$("#"+outerDivId).width(displayWidth);$("#"+outerDivId).height(displayHeight);$("#"+elId).appendTo("#"+outerDivId);$("#"+outerDivId).offset({top:(matrixOrder[m].row)*displayHeight+offsetY,left:(matrixOrder[m].column)*displayWidth+offsetX});if(opts.fullScreenBackground){if(opts.preloadBackgroundImages){preloadBackgroundImages()}setFullScreenBackground(matrixOrder[m])}if(m==0&&matrixOrder[m].ajaxLoading){loadContent(matrixOrder[m])}}}function preloadBackgroundImages(){var cache=[];$(" ."+opts.backGroundImageClass).each(function(){var $img=$(this);var cacheImage=document.createElement('img');cacheImage.src=$img.attr("src");cache.push(cacheImage)})}function positionMap(){var mapWidth=$("#slidingSpacesNavigationMap").outerWidth(true);var mapHeight=$("#slidingSpacesNavigationMap").outerHeight(true);var mapInnerX=mapWidth-$("#slidingSpacesNavigationMap").width();var mapInnerY=mapHeight-$("#slidingSpacesNavigationMap").height();var elementToScrollTop=0;var elementToScrollLeft=0;if(opts.container!="none"){var elementToScrollTop=$(elementToScroll).offset().top;var elementToScrollLeft=$(elementToScroll).offset().left}if(opts.mapPosition.toLowerCase()=="top_left"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop,left:elementToScrollLeft})}else if(opts.mapPosition.toLowerCase()=="top_center"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop,left:elementToScrollLeft+((displayWidth/2)-(mapWidth/2))})}else if(opts.mapPosition.toLowerCase()=="top_right"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop,left:elementToScrollLeft+(displayWidth-mapWidth)})}else if(opts.mapPosition.toLowerCase()=="center_right"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+((displayHeight/2)-(mapHeight/2)),left:elementToScrollLeft+(displayWidth-mapWidth)})}else if(opts.mapPosition.toLowerCase()=="bottom_center"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+displayHeight-mapHeight,left:elementToScrollLeft+((displayWidth/2)-(mapWidth/2))})}else if(opts.mapPosition.toLowerCase()=="bottom_left"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+displayHeight-mapHeight,left:elementToScrollLeft})}else if(opts.mapPosition.toLowerCase()=="center_left"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+((displayHeight/2)-(mapHeight/2)),left:elementToScrollLeft})}else if(opts.mapPosition.toLowerCase()=="center_center"){$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+((displayHeight/2)-(mapHeight/2)),left:elementToScrollLeft+((displayWidth/2)-(mapWidth/2))})}else{$("#slidingSpacesNavigationMap").css({top:elementToScrollTop+displayHeight-mapHeight,left:elementToScrollLeft+displayWidth-mapWidth})}$("#slidingSpacesNavigationMap").width(mapWidth-mapInnerX);$("#slidingSpacesNavigationMap").height(mapHeight-mapInnerY)}function refreshMap(actualElementId){$("#slidingSpacesNavigationMap a").each(function(index){$dot=$(this);var id="";if(typeof($dot.attr("id"))!="undefined"){id=$dot.attr("id").split("_")}if(id.length==2){if(id[1]==actualElementId){$dot.attr("class","slidingSpacesNavigationDotActual");$dot.attr("href","")}else{$dot.attr("class","slidingSpacesNavigationDot");$dot.attr("href","#"+id[1])}}});$(".slidingSpacesNavigationDot").each(function(index){var $el2=$(this);$el2.unbind("click");$el2.bind("click",function(event){clickEvent(event,$el2)})});$(".slidingSpacesNavigationDotActual").each(function(index){var $el2=$(this);$el2.unbind("click");$el2.removeAttr("href")})}function refreshPosition(oldWidth,oldHeight){zIndex=-1000;var actualElement=findElementByOffset(oldWidth,oldHeight);for(i=0;i<matrixOrder.length;i++){var shiftX=matrixOrder[i].column*(displayWidth);var shiftY=matrixOrder[i].row*(displayHeight);var actualId=matrixOrder[i].id;var outerDivId="slidingSpacesOuterDiv_"+actualId;$("#"+outerDivId).width(displayWidth);$("#"+outerDivId).height(displayHeight);if(shiftY>0){$("#"+outerDivId).offset({top:shiftY+((displayHeight-oldHeight))*(matrixOrder[i].row)})}if(shiftX>0){$("#"+outerDivId).offset({left:shiftX+((displayWidth-oldWidth))*(matrixOrder[i].column)})}if(opts.fullScreenBackground){scaleBackground($("#"+matrixOrder[i].id+" ."+opts.backGroundImageClass))}}$("#slidingSpacesNavigationFeedback").width(displayWidth);$("#slidingSpacesNavigationFeedback").height(displayHeight);if(actualElement.id!=null){var reActualElement=findElementById(actualElement.id);$(elementToScroll).animate({scrollTop:reActualElement.row*displayHeight,scrollLeft:reActualElement.column*displayWidth},0);actualOffsetX=reActualElement.column*displayWidth;actualOffsetY=reActualElement.row*displayHeight}}function scaleBackground(element){w=element.width();h=element.height();var ratio=h/w;if((displayHeight/displayWidth)>ratio){element.height(displayHeight);element.width(displayHeight/ratio)}else{element.width(displayWidth);element.height(displayWidth*ratio)}zIndex+=zIndexDecrement;zIndexDecrement--;element.css('position','absolute');element.css('float','left');element.css('z-index',zIndex);element.css('left',(displayWidth-element.width())/2);element.css('top',(displayHeight-element.height())/2)}function setFullScreenBackground(element){var backgroundImage=$("#"+element.id+" ."+opts.backGroundImageClass);var w=0;var h=0;$(backgroundImage).load(function(){scaleBackground($(this))}).error(function(){$(this).remove()})}function setMagicNumbers(){if(opts.container=="none"){displayWidth=$(window).width();displayHeight=$(window).height();offsetX=0;offsetY=0;elementToScroll="html,body"}else{displayWidth=$(opts.container).outerWidth(true);displayHeight=$(opts.container).outerHeight(true);offsetX=$(opts.container).offset().left;offsetY=$(opts.container).offset().top;elementToScroll=opts.container}}}};$.fn.ferroSlider=function(arguments){return methods.ferroSliderDesktop.call(this,arguments)}})(jQuery);